"use strict";const eTemplate=function(){this.htmlCode=[],this.htmlType=[],this.htmlSync=[],this.cssRules=[],this.cssCode=[],this.cssType=[],this.syncCnt=0,this.titleCode="",this.fileName=""};eTemplate.prototype.render=async function({syncUrl:e="",scrollTo:t={},startUrl:s="",syncClass:l="et_sync",iScope:r=""}={}){this.syncCnt=0,this.syncClass=l;let n=this.currentUrl().host+this.currentUrl().filename;""==e&&""!=s&&(e=s),""==e&&(e=this.currentUrl().filename),this.fileName=e,n=this.currentUrl().host+e;const i=await fetch(n),c=await i.text(),o=await this.getGoing(c,r);return this.removeAllChildNodes(document.querySelector("body")),document.body.insertAdjacentHTML("afterbegin",o.htmlBlock.join("")),t!={}&&0!=Object.keys(t).length&&document.getElementById(t.id).scrollIntoView({block:t.block}),this.htmlCode=o.codeList.code,this.htmlType=o.codeList.type,"function"==typeof addListener&&addListener(e),document.body.style.display="block",new Promise(((e,t)=>{e("done")}))},eTemplate.prototype.getGoing=async function(e,t){"body"!=t&&await this.changeCss(e),this.getTitle(e),this.changeTitle();let{finalHTML:s,codeList:l}=await this.insertNestedHTML(e);l=this.seperateCode(s,"second");let r=this.makeSyncBlock(l.type,l.code);"JS"==l.type[0]&&(l.type.unshift("HTML"),l.code.unshift(" "),r=r.map((e=>e+1)),r.unshift(0)),l=this.insertSync(l.type,l.code,r),this.htmlSync=r,this.syncCnt=l.syncCnt;let n=this.interpret(l.type,l.code);return new Promise(((e,t)=>{e({htmlBlock:n,codeList:l})}))},eTemplate.prototype.sync=function(e){let t="",s=this.syncClass;this.changeTitle(),document.querySelectorAll(`.${s}`).forEach((e=>{if(t="","INPUT"==e.nodeName){t=e.getAttribute("data-sync"),"number"==e.type?t+="="+(e.value?e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;"):'""'):t+="="+(e.value?'"'+e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;")+'"':'""');try{temp_code=this.controlCode(t)}catch(e){return e}}}));let l=this.interpretPart(this.htmlType,this.htmlCode,s);document.querySelectorAll(`.${s}`).forEach((e=>{let t=e.classList,r="",n=!1,i=0;t.forEach((e=>{e.includes(`${s}_`)&&(n=!0,r=e.split("_").pop()),e.includes(`${s}Cnt`)&&(i=parseInt(e.replace(`${s}Cnt`,""),10))})),n?e.setAttribute(r,l[i]):(this.removeAllChildNodes(e),e.insertAdjacentHTML("afterbegin",l[i]))})),"body"!=e&&this.syncCss()},eTemplate.prototype.syncCss=function(){if(0==this.cssType.length||!this.cssType.includes("JS"))return!0;let e=this.interpret(this.cssType,this.cssCode),t=this.parseCSS(e.join("")),s=0;for(let e=0;e<document.styleSheets.length;e++)if(null==document.styleSheets[e].href){s=e;break}let l=this.cssRules;const r=/\s+|\\n/g;let n="",i=[],c=[];t.forEach(((e,t)=>{let o=null==e.type?"":e.type,a=-1,u=0,p="";switch(o){case"keyframes":for(let t=0;t<l.length;t++){let s=l[t],r=e.styles.substring(0,e.styles.indexOf("{")).trim(),n=s.styles.substring(0,s.styles.indexOf("{")).trim();if("keyframes"==s.type&&r==n){a=t;break}}if(a>-1){let t=l[a].styles,n=e.styles;t.replace(r,"")!=n.replace(r,"")&&(document.styleSheets[s].deleteRule(a),document.styleSheets[s].insertRule(n,a)),c.push([a,-2,0,7])}else i.push(["rule",t,-1,-1,e.styles]);break;case"media":case"supports":u="media"==o?4:12;for(let t=0;t<l.length;t++){let s=l[t];if(s.type==o&&e.selector==s.selector){a=t;break}}if(a>-1)e.subStyles.forEach(((e,r)=>{p=e.selector;let o=-1;for(let e=0;e<l[a].subStyles.length;e++)if(l[a].subStyles[e].selector==p){o=e;break}if(o>-1)e.rules.forEach(((e,n)=>{let p=-1;for(let t=0;t<l[a].subStyles[o].rules.length;t++){if(l[a].subStyles[o].rules[t].key==e.key){p=t;break}}if(p>-1){let t=l[a].subStyles[o].rules[p].key,r=l[a].subStyles[o].rules[p].value,n=e.value;r!=n&&document.styleSheets[s].cssRules[a].cssRules[o].style.setProperty(t,n),c.push([a,o,p,u])}else i.push(["style",t,r,n,e.key,e.value])}));else{n=" "+e.selector+" {\n";for(let t=0;t<e.rules.length;t++)n+=` ${e.rules[t].key}: ${e.rules[t].value};\n`;n+=" }\n",i.push(["rule",t,r,-1,n])}}));else{n=e.selector+" {\n";for(let t=0;t<e.subStyles.length;t++){let s=e.subStyles[t];n=n+" "+s.selector+" {\n";for(let e=0;e<s.rules.length;e++)n+=` ${s.rules[e].key}: ${s.rules[e].value};\n`;n+=" }\n"}n+="}\n",i.push(["rule",t,-1,-1,n])}break;case"":case"font-face":u="font-face"==o?5:1;for(let t=0;t<l.length;t++){let s=l[t];if(e.selector==s.selector){a=t;break}}if(a>-1)e.rules.forEach(((e,r)=>{let o=-1;for(let t=0;t<l[a].rules.length;t++){if(l[a].rules[t].key==e.key){o=t;break}}if(o>-1){let t=l[a].rules[o].key,r=l[a].rules[o].value,n=e.value;r!=n&&document.styleSheets[s].cssRules[a].style.setProperty(t,n),c.push([a,-1,o,u])}else n=` ${e.key}: ${e.value};\n`,i.push(["style",t,-1,r,e.key,e.value])}));else{n=e.selector+" {\n";for(let t=0;t<e.rules.length;t++)n+=` ${e.rules[t].key}: ${e.rules[t].value};\n`;n+="}\n",i.push(["rule",t,-1,-1,n])}}}));let o=0,a=0;for(let e=l.length-1;e>=0;e--){let t=0,r=l[e];switch(r.type){case"media":case"supports":t="media"==r.type?4:12,o=r.subStyles.length;for(let l=o-1;l>=0;l--){a=r.subStyles[l].rules.length;for(let n=a-1;n>=0;n--){if(this.arrayFind(c,[e,l,n,t])<0){let t=r.subStyles[l].rules[n].key;document.styleSheets[s].cssRules[e].cssRules[l].style.removeProperty(t)}}0==document.styleSheets[s].cssRules[e].cssRules[l].style.length&&document.styleSheets[s].cssRules[e].deleteRule(l)}0==document.styleSheets[s].cssRules[e].cssRules.length&&document.styleSheets[s].deleteRule(e);break;case"":case"font-face":t=""==r.type?1:5,a=r.rules.length;for(let l=a-1;l>=0;l--){if(this.arrayFind(c,[e,-1,l,t])<0){let t=r.rules[l].key;document.styleSheets[s].cssRules[e].style.removeProperty(t)}}0==document.styleSheets[s].cssRules[e].style.length&&document.styleSheets[s].deleteRule(e);break;case 7:this.arrayFind(c,[e,-2,0,7])<0&&document.styleSheets[s].deleteRule(e)}}for(let e=0;e<i.length;e++){let[t,l,r,n,c,o=""]=i[e];"style"==t?-1==r?document.styleSheets[s].cssRules[l].style.setProperty(c,o):document.styleSheets[s].cssRules[l].cssRules[r].style.setProperty(c,o):-1==r?document.styleSheets[s].insertRule(c,l):document.styleSheets[s].cssRules[l].insertRule(c,r)}this.cssRules=JSON.parse(JSON.stringify(t))},eTemplate.prototype.findInclude=function(e){let t=[],s=[],l=[],r="",n=0,i="",c=e.indexOf("<body>"),o=e.indexOf("</body>");i=-1==c||-1==o?e:e.substring(c+6,o);let a=this.seperateCode(i,"first");for(let e=0;e<a.type.length;e++)"JS"==a.type[e]&&-1!=a.code[e].search(/include\(.*\)/g)&&(t.push(a.code[e]),l[n]=e,n++);return 0!=t.length&&t.forEach((e=>{e.includes("include(")&&(c=e.indexOf('include("'),-1==c?c=e.indexOf("include('")+9:c+=9,o=e.indexOf('")'),-1==o&&(o=e.indexOf("')")),r=e.substring(c,o),r="/"==r.substring(0,1)?r.substring(1):r,r="./"==r.substring(0,2)?r.substring(2):r,s.push(this.currentUrl().host+r))})),{urls:s,order:l,codeList:a.code}},eTemplate.prototype.insertNestedHTML=async function(e){let t="",{urls:s,order:l,codeList:r}=this.findInclude(e);if(0!=s.length){let e=s.map((e=>fetch(e))),n=await Promise.all(e),i=n.filter((e=>!e.ok));if(i.length>0)throw i.map((e=>Error(e.statusText)));let c=n.map((e=>e.text()));return(await Promise.all(c)).forEach(((e,t)=>{r[l[t]]=e})),t=r.join(""),({urls:s,order:l,codeList:r}=this.findInclude(t)),0!=s.length?(({finalHTML:t,codeList:r}=await this.insertNestedHTML(t)),{finalHTML:t,codeList:r}):{finalHTML:t,codeList:r}}return t=r.join(""),{finalHTML:t,codeList:r}},eTemplate.prototype.seperateCode=function(e,t){let s=e.split(/(<%[^%].*?%>)/g),l=[];return s.forEach(((e,r)=>{let n=e.indexOf("<%"),i=e.indexOf("%>");0==n&&i==e.length-2?(l.push("JS"),s[r]="second"==t?e.substring(2,e.length-2).trim():e.trim()):(l.push("HTML"),s[r]=e.replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").trim())})),{type:l,code:s}},eTemplate.prototype.interpret=function(e,t){let s=[],l=0;for(;l<t.length;){switch(e[l]){case"HTML":s.push(t[l].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==t[l].substring(0,1)){try{s.push(this.basicCode(t[l].substring(1)))}catch(e){s.push("invalid template")}break}if("-"==t[l].substring(0,1)){try{s.push(this.basicCode(t[l].substring(1)))}catch(e){s.push("invalid template")}break}{let r=this.eachBlock(e,t,l);l=r.index;try{s.push(this.controlCode(r.partBlock))}catch(e){s.push("invalid template")}break}}l++}return s},eTemplate.prototype.interpretPart=function(e,t,s){let l=[],r="",n=[],i=[],c=[],o=0,a=0,u=0,p=0;for(o=0;o<t.length;o++)if(c.length=0,"HTML"==e[o]&&(a=0,r="",c=t[o].replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").split("<"),c.forEach((e=>{e.includes("class=")&&e.includes(s)&&(r=e.substring(0,e.indexOf(" ")).trim())})),r.length>0))for(u=this.htmlSync[o+1],a=o+1;a<t.length&&this.htmlSync[a]==u;a++)n.push(e[a]),i.push(t[a]);for(;p<i.length;){switch(n[p]){case"HTML":l.push(i[p].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==i[p].substring(0,1)){try{l.push(this.basicCode(i[p].substring(1)))}catch(e){l.push("invalid template script")}break}if("-"==i[p].substring(0,1)){try{l.push(this.basicCode(i[p].substring(1)))}catch(e){l.push("invalid template script")}break}{let e=this.eachBlock(n,i,p);p=e.index;try{l.push(this.controlCode(e.partBlock))}catch(e){l.push("invalid template script")}break}}p++}return l},eTemplate.prototype.makeSyncBlock=function(e,t){let s=[],l=0,r=0,n=0;for(let i=0;i<t.length;i++){switch(e[i]){case"HTML":s.push(l);break;case"JS":if("="==t[i].substring(0,1)||"-"==t[i].substring(0,1)){s.push(l);break}r=this.findBlockEnd(e,t,i).index,n=this.findBlockEnd(e,t,i).braceBalance,n<0?console.log("ERROR: missing {"):n>0&&console.log("ERROR: missing }");for(let e=0;e<r-i+1;e++)s.push(l);i=r}l++}return s},eTemplate.prototype.findBlockEnd=function(e,t,s){let l=0,r=0;for(r=s;r<t.length;r++)if(r!=s||"JS"!=e[r]){if("HTML"!=e[r]&&"JS"==e[r]&&"="!=t[r].substring(0,1)&&"-"!=t[r].substring(0,1)&&(t[r].includes("{")&&l++,t[r].includes("}")&&l--,0==l))return{index:r,error:0}}else if(t[r].includes("{")&&l++,t[r].includes("}")&&l--,0==l)return{index:r,error:0};return 0!=l?{index:s,braceBalance:l}:{index:r,braceBalance:l}},eTemplate.prototype.eachBlock=function(e,t,s){let l="",r=0,n=0;for(n=s;n<t.length;n++){if(n==s){if("JS"==e[n]){if(t[n].includes("{")&&r++,t[n].includes("}")&&r--,0==r)return{partBlock:t[n],index:n};l=`let answer=''; ${t[n]}`;continue}l=`let answer='${t[n]}';`}if("HTML"!=e[n]){if("JS"==e[n])if("="==t[n].substring(0,1))l+=`answer=answer+${t[n].substring(1)};`;else if("-"==t[n].substring(0,1))l+=`answer=answer+${t[n].substring(1)};`;else if(l+=t[n],t[n].includes("{")&&r++,t[n].includes("}")&&r--,0==r)return l+="; return answer;",{partBlock:l,index:n}}else l+=`answer=answer+'${t[n]}';`}return l+="; return answer;",{partBlock:l,index:n}},eTemplate.prototype.insertSync=function(e,t,s){let l=-1,r=0,n=0,i="",c="",o="",a="",u=0,p=0,h=0,d=this.syncCnt;const y=this.syncClass;for(let f=0;f<s.length;f++)if(s[f]!=l&&"JS"==e[f]){l=s[f],p=0,h=0,u=f;for(let e=f;e<s.length&&s[e]==s[u];e++)p=e;if(o=t[f-1],">"!=o.substring(o.length-1))if(n=o.lastIndexOf(">"),r=o.lastIndexOf("<"),n<r){i=o.substring(r);let e=o.lastIndexOf(" "),s=o.lastIndexOf('="'),l=o.substring(e+1,s);i.includes("class=")?(h=o.indexOf("class=",r)+7,t[f-1]=`${o.substring(0,h)}${y} ${y}_${l} ${y}Cnt${d} ${o.substring(h)}`,d++):(a=t[f+1],n=a.indexOf(">"),i=a.substring(0,n),i.includes("class=")?(h=a.indexOf("class=")+7,t[f+1]=`${a.substring(0,h)}${y} ${y}_${l} ${y}Cnt${d} ${a.substring(h)}`,d++):(r=o.lastIndexOf("<"),n=o.indexOf(" ",r),t[f-1]=`${o.substring(0,n+1)} class="${y} ${y}_${l} ${y}Cnt${d}" ${o.substring(n+1)}`,d++))}else t[f-1]=t[f-1]+`<span class="${y} ${y}Cnt${d}">`,d++,t[p+1]="</span>"+t[p+1];else r=o.lastIndexOf("<"),c=o.substring(r+1,o.length).split(" ")[0],"</"!=o.substring(r,r+2)?t[p+1].includes("</"+c)&&t[p+1].indexOf("</"+c)<(-1==t[p+1].indexOf("<"+c)?t[p+1].length:t[p+1].indexOf("<"+c))?(n=o.length-1,r=o.lastIndexOf("<"),i=o.substring(r,n+1),i.includes("class=")?(h=o.indexOf("class=",r)+7,t[f-1]=`${o.substring(0,h)}${y} ${y}Cnt${d} ${o.substring(h)}`,d++):(t[f-1]=`${o.substring(0,o.length-1)} class="${y} ${y}Cnt${d}" ${o.substring(o.length-1,o.length)}`,d++)):(t[f-1]=`${t[f-1]}<span class="${y} ${y}Cnt${d}">`,d++,t[f+1]=`</span>${t[f+1]}`):(t[f-1]=`${t[f-1]}<span class="${y} ${y}Cnt${d}">`,d++,t[p+1]=`</span>${t[p+1]}`)}else l=s[f];return{type:e,code:t,syncCnt:d}},eTemplate.prototype.getTitle=function(e){const t=e.match(/<head>(.|[\t\n\r])*?<\/head>/g)[0].match(/<title>(.|[\t\n\r])*?<\/title>/g)[0].replace("<title>","").replace("</title>","").trim();this.titleCode=t.length>0?t:this.titleCode},eTemplate.prototype.changeTitle=function(){let e=null;null!=this.titleCode.trim().match(/<%.*?%>/g)&&(e=this.titleCode.trim().match(/<%.*?%>/g)[0].replaceAll("<%","").replaceAll("%>",""));let t="";null!=e&&(t=this.basicCode(e),document.head.querySelector("title").innerText=t)},eTemplate.prototype.changeCss=async function(e){let t=await this.combineCss(e),s=this.seperateCode(t,"second");this.cssCode=s.code,this.cssType=s.type,t=this.interpret(s.type,s.code).join("");let l=this.parseCSS(t);this.cssRules=l;const r=this.createTextStyle(l);if(""!=r){document.querySelectorAll("style").forEach((e=>{e.parentNode.removeChild(e)}));let e=document.createElement("style");e.appendChild(document.createTextNode(r)),document.head.appendChild(e),document.head.querySelectorAll("link").forEach((e=>{"stylesheet"!=e.getAttribute("rel")||e.getAttribute("href").includes("http")||e.parentNode.removeChild(e)}))}},eTemplate.prototype.combineCss=async function(e){let t="",s=[],l=[];let r=e.indexOf("<head>"),n=e.indexOf("</head>");if(-1==r||-1==n)return"";e.replace(/<style>(.|[\t\n\r])*?<.style>/gi,(function(e){return l.push(e.replaceAll("<style>","").replaceAll("</style>","")),""})),t=l.join("");let i=[];e.replace(/<link.*?(rel=("|')stylesheet("|')).*?>/gi,(function(e){return i.push(e),""}));let c=this.currentUrl().host;if(i.forEach((e=>{let t=e.match(/href=".*?"/gi)[0].replaceAll("href=","").replaceAll('"',"");t.includes("http")||s.push(c+t)})),0!=s.length){let e=s.map((e=>fetch(e))),l=await Promise.all(e),r=l.filter((e=>!e.ok));if(r.length>0)throw r.map((e=>Error(e.statusText)));let n=l.map((e=>e.text()));(await Promise.all(n)).forEach((e=>{t+=e}))}return t=await this.insertNestedCSS(t),t},eTemplate.prototype.insertNestedCSS=async function(e){let t="",{urls:s,order:l,codeList:r}=this.findImport(e);if(0!=s.length){let e=s.map((e=>fetch(e))),n=await Promise.all(e),i=n.filter((e=>!e.ok));if(i.length>0)throw i.map((e=>Error(e.statusText)));let c=n.map((e=>e.text()));return(await Promise.all(c)).forEach(((e,t)=>{r[l[t]]=e})),t=r.join(""),({urls:s,order:l,codeList:r}=this.findImport(t)),0!=s.length?(t=await this.insertNestedCSS(t),t):t}return t=r.join(""),t},eTemplate.prototype.findImport=function(e){let t=[],s=[],l=[],r="",n=0;const i=/@import *["|'].*?["|'];/g;let c=this.seperateImport(e);for(let e=0;e<c.type.length;e++)"IMPORT"==c.type[e]&&-1!=c.code[e].search(i)&&(t.push(c.code[e]),l[n]=e,n++);return 0!=t.length&&t.forEach((e=>{r=e.match(i)[0].replaceAll("@import","").replaceAll('"',"").replaceAll(";","\n").trim(),r="/"==r.substring(0,1)?r.substring(1):r,r="./"==r.substring(0,2)?r.substring(2):r,s.push(this.currentUrl().host+r)})),{urls:s,order:l,codeList:c.code}},eTemplate.prototype.seperateImport=function(e){let t=e.split(/(@import *["|'].*?["|'];)/g),s=[];return t.forEach(((e,l)=>{e.includes("@import")?(s.push("IMPORT"),t[l]=e.trim()):(s.push("OTHER"),t[l]=e.replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").trim())})),{type:s,code:t}},eTemplate.prototype.createTextStyle=function(e){let t="",s=JSON.parse(JSON.stringify(e));for(let e=0;e<s.length;e++){let l=s[e];switch(null==l.type?"":l.type){case"":case"font-face":t=t+l.selector+" {\n";for(let e=0;e<l.rules.length;e++)t+=` ${l.rules[e].key}: ${l.rules[e].value};\n`;t+="}\n";break;case"imports":case"keyframes":t=t+l.styles.replaceAll("{","{\n").replaceAll("}","}\n").replaceAll(";",";\n")+"\n";break;case"supports":case"media":t=t+l.selector+" {\n";for(let e=0;e<l.subStyles.length;e++){let s=l.subStyles[e];t=t+" "+s.selector+" {\n";for(let e=0;e<s.rules.length;e++)t+=` ${s.rules[e].key}: ${s.rules[e].value};\n`;t+=" }\n"}t+="}\n"}}return t},eTemplate.prototype.basicCode=function(e){try{return Function(`"use strict"; return ( ${e.substring(1)} )`)()}catch(e){return"invalid template script"}},eTemplate.prototype.controlCode=function(e){try{return Function(`"use strict"; ${e.replace(/[\n\r\t]/g,"")}`)()}catch(e){return"invalid template script"}},eTemplate.prototype.renderPart=async function(e="",t=""){let s="",l="",r="",n=[],i=[],c="";if(""==t.trim())return"select type from html, html_path";if(""==e.trim())return"nothing to render";switch(t){case"html":return s=e,n=this.seperateCode(s,"second"),i=this.makeSyncBlock(n.type,n.code),"JS"==n.type[0]&&(n.type.unshift("HTML"),n.code.unshift(" "),i=i.map((e=>e+1)),i.unshift(0)),n=this.insertSync(n.type,n.code,i),l=this.interpret(n.type,n.code),c=l.join(""),{domText:c,sourceType:n.type,sourceCode:n.code,sourceSync:i};case"html_path":r=window.location.host+e;try{const e=await fetch(r);s=await e.text()}catch(e){return"incorrect pathname. should be relative to root directory"}return n=this.seperateCode(s,"second"),i=this.makeSyncBlock(n.type,n.code),"JS"==n.type[0]&&(n.type.unshift("HTML"),n.code.unshift(" "),i=i.map((e=>e+1)),i.unshift(0)),n=this.insertSync(n.type,n.code,i),l=this.interpret(n.type,n.code),c=l.join(""),{domText:c,sourceType:n.type,sourceCode:n.code,sourceSync:i}}},eTemplate.prototype.appendHtml=function(e={},t){let s=e.domText||"";if(null==t)return"no element to append to";const l=e.sourceType||[],r=e.sourceCode||[],n=e.sourceSync||[];return"DOMobject"!=this.getObjectType(t)?"invalid object to append":0==l.length?"nothing to append":(this.htmlType=this.htmlType.concat(l),this.htmlCode=this.htmlCode.concat(r),this.htmlSync=this.htmlSync.concat(n),s=s.trim(),""==s?"nothing to append":void t.insertAdjacentHTML("beforeend",s))},eTemplate.prototype.currentUrl=function(){let e=window.location.href,t=window.location.hash;e=e.replace(t,"");let s=e.split("/").pop(),l=e.substring(0,e.length-s.length);return""!=t&&(s=t.substring(1)+".html"),{host:l,filename:s}},eTemplate.prototype.loadjscssfile=function(e,t){if("js"==t){let t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e)}else if("css"==t){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)}"undefined"!=typeof fileRef&&document.getElementsByTagName("head")[0].appendChild(fileRef)},eTemplate.prototype.createjscssfile=function(e,t){if("js"==t){let t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e)}else if("css"==t){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)}return fileRef},eTemplate.prototype.replacejscssfile=function(e){let t=document.querySelectorAll('link[rel="stylesheet"]'),s=new Array(t.length),l=0,r="";for(i=0;i<t.length;i++)s[i]=0;for(i=0;i<e.length;i++){l=0;for(let n=t.length-1;n>=0;n--)r=t[n].getAttribute("href"),r=r.replace(this.currentUrl().host,"/"),-1!=r.indexOf(e[i])&&(l++,s[n]++);0==l&&this.loadjscssfile(e[i],"css")}for(i=0;i<s.length;i++)0==s[i]&&t[i].parentNode.removeChild(t[i])},eTemplate.prototype.getObjectType=e=>("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)?"DOMobject":e.includes("<%")&&e.includes("%>")?"template":e.includes(".html")?"html_path":e.includes(".css")?"css_path":"undefined",eTemplate.prototype.hashtofilename=function(e){let t=window.location.hash;return""!=t&&""==e&&(e=t.substring(1)+".html"),e},eTemplate.prototype.removeAllChildNodes=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},eTemplate.prototype.parseCSS=function(e){if(void 0===e)return[];let t,s=/((@keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi,l=/@import .*?\(.*?\);/gi,r=[];for([...(e=e.replace(/\/\*.*?\*\//gi,"")).matchAll(l)].forEach((e=>{r.push({selector:"@imports",type:"imports",styles:e[0]})})),e=e.replace(l,"");t=s.exec(e),null!==t;)r.push({selector:"@keyframes",type:"keyframes",styles:t[0]});e=e.replace(s,"");let n=/((\s*?(?:\/\*[\s\S]*?\*\/)?\s*?(@media|@supports)[\s\S]*?){([\s\S]*?)}\s*?})|(([\s\S]*?){([\s\S]*?)})/gi;for(;t=n.exec(e),null!==t;){let e="";if(e=void 0===t[2]?t[6].split("\r\n").join("\n").trim():t[2].split("\r\n").join("\n").trim(),e=e.replace(/\n+/,"\n"),-1!==e.indexOf("@media")){let s={selector:e,type:"media",subStyles:this.parseCSS(t[4]+"\n}")};r.push(s)}else if(-1!==e.indexOf("@supports")){let s={selector:e,type:"supports",subStyles:this.parseCSS(t[4]+"\n}")};r.push(s)}else{let s={selector:e,type:"",rules:this.parseRules(t[7])};"@font-face"===e&&(s.type="font-face"),r.push(s)}}return r},eTemplate.prototype.parseRules=function(e){let t=[];e=(e=e.split("\r\n").join("\n")).split(";");for(let s=0;s<e.length;s++){let l=e[s];if(l=l.trim(),-1!==l.indexOf(":")){l=l.split(":");let e=l[0].trim(),s=l.slice(1).join(":").trim();if(e.length<1||s.length<1)continue;t.push({key:e,value:s})}else"base64,"===l.trim().substr(0,7)?t[t.length-1].value+=l.trim():l.length>0&&t.push({key:"",value:l,defective:!0})}return t},eTemplate.prototype.arrayFind=function(e,t){let s={};for(let t=0;t<e.length;t++)s[e[t]]=t;return s.hasOwnProperty(t)?s[t]:-1},document.onmouseover=function(){window.innerDocClick=!0},document.onmouseleave=function(){window.innerDocClick=!1};