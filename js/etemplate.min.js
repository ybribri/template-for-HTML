let sync_type=[],sync_code=[],sync_block=[],et={};async function eTemplate(e){let t,n,i,r,s;void 0===e&&(e={}),t=void 0===e.sync_url?"":e.sync_url,n=void 0===e.data?"":e.data,i=void 0===e.scrollto?"":e.scrollto,r=void 0===e.sync_type?"":e.sync_type,""!=n&&0!=Object.keys(n).length&&createVariable(n),void 0===e.start_url?s="":et.start_url=e.start_url,"body"==r?(et.sync_type="body",et.sync_class=""):(et.sync_type="element",et.sync_class="et_sync");let l=currentUrl().host+currentUrl().filename;t=hashtofilename(t),void 0!==t&&""!=t&&null!=t&&(l=currentUrl().host+t);let c=await request(l);return await getGoing(c,i),"function"==typeof addListener&&addListener(t),window.onhashchange=function(){if(!window.innerDocClick){let e=window.location.href,t=e.split("#").pop();e.includes("#")&&0!=t.trim().length?eTemplate({sync_url:`${t}.html`}):void 0!==et.start_url?eTemplate({sync_url:et.start_url}):eTemplate({sync_url:"index.html"})}},new Promise(((e,t)=>{e("done")}))}function syncTemplate(e){let t,n="",i=et.sync_class;if(t=void 0!==e&&void 0!==e.target.nodeName?e.target.nodeName:"",void 0===i||""==i){let e=0;if(sync_type.forEach((t=>{"JS"==t&&(e=1)})),0!=e){""!=typeof t&&"INPUT"==t&&document.querySelectorAll("[data-sync]").forEach((e=>{if(n="","INPUT"==e.nodeName){n=e.getAttribute("data-sync"),n="number"==e.type?n+"="+(e.value?e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;"):'""'):n+"="+(e.value?'"'+e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;")+'"':'""');try{temp_code=controlCode(n)}catch(e){return e}}}));let e=interpret(sync_type,sync_code).join("");document.body.innerHTML=e;let i=hashtofilename();"function"==typeof addListener&&addListener(i)}}else{""!=typeof t&&"INPUT"==t&&document.querySelectorAll(`.${i}`).forEach((e=>{if(n="","INPUT"==e.nodeName){n=e.getAttribute("data-sync"),n="number"==e.type?n+"="+(e.value?e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;"):'""'):n+"="+(e.value?'"'+e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;")+'"':'""');try{temp_code=controlCode(n)}catch(e){return e}}}));let e=interpretPart(sync_type,sync_code,i);document.querySelectorAll(`.${i}`).forEach(((t,n)=>{"INPUT"!=t.nodeName?t.innerHTML=e[n]:t.value=e[n]}))}}const request=async e=>{let t=await fetch(e),n=await t.text();return new Promise(((e,t)=>{e(n)}))};async function getGoing(e,t){let n=seperateCode(await getTemplates(e),"second"),i=makeSyncBlock(n.type,n.code);n=insertSync(n.type,n.code,i);let r=interpret(n.type,n.code).join("");return document.body.innerHTML=r,""!=t&&0!=Object.keys(t).length&&""!=t&&document.getElementById(t.id).scrollIntoView({block:t.block}),sync_code=n.code,sync_type=n.type,new Promise(((e,t)=>{e({t_code:sync_code,t_type:sync_type})}))}async function getTemplates(e){let t=[],n=[],i=[],r="",s="",l=findIncludeScript(e);if(t=l.urls,n=l.order,i=l.t_code,t_type=l.t_type,0!=t.length){let e=t.map((e=>fetch(e))),c=await Promise.all(e),a=c.filter((e=>!e.ok));if(a.length>0)throw a.map((e=>Error(e.statusText)));let o=c.map((e=>e.text())),u=await Promise.all(o);if(u.forEach(((e,t)=>{i[n[t]]=e})),r=i.join(""),l=findIncludeScript(r),t=l.urls,n=l.order,i=l.t_code,t_type=l.t_type,0!=t.length){if(e=t.map((e=>fetch(e))),c=await Promise.all(e),a=c.filter((e=>!e.ok)),a.length>0)throw a.map((e=>Error(e.statusText)));o=c.map((e=>e.text())),u=await Promise.all(o),u.forEach(((e,t)=>{i[n[t]]=e})),s=i.join("")}else s=r}else s=i.join("");return new Promise(((e,t)=>{e(s)}))}function findIncludeScript(e){let t,n,r=[],s=[],l=[],c=[],a="",o=0,u=0,d=0;o=e.indexOf("<head>"),u=e.indexOf("</head>"),-1!=o&&-1!=u&&(t=e.substring(o+6,u),s=findCss(t),replacejscssfile(s)),n=-1!=e.indexOf("<body>")?e.match(/(?<=<body>(\n|\r|.))(.|\n|\r)*/g)[0]:e;let p=seperateCode(n,"first"),h=p.type,f=p.code;for(i=0;i<h.length;i++)"JS"==h[i]&&-1!=f[i].search(/include\(.*\)/g)&&(r.push(f[i]),c[d]=i,d++);return 0==r.length||r.forEach((e=>{e.includes("include(")&&(a=e.match(/(?<=include.['"]).*html/g)[0],a="/"==a.substring(0,1)?a.substring(1):a,l.push(currentUrl().host+a))})),{urls:l,order:c,t_code:f,t_type:h}}function findCss(e){let t=[],n=[];for(n=e.match(/<link .*">/g),null==n&&(n=[]),i=0;i<n.length;i++)t.push(n[i].match(/(?<=href=("|')).*css/g));return t}function seperateCode(e,t){let n=e.length,r=[],s=[],l=[],c=[],a=0,o=0,u=2,d=0;for("first"==t&&(u=0,d=2),i=0;i<n;i++)a=e.indexOf("<%",i),a!=l[l.length-1]&&-1!=a&&l.push(a);for(i=0;i<n;i++)o=e.indexOf("%>",i),o!=c[c.length-1]&&-1!=o&&c.push(o);if(l.length>0){for(i=0;i<l.length;)i>c.length-1?temp=l.splice(i,1):l[i]>c[i]?temp=c.splice(i,1):i+1!=l.length&&l[i+1]<c[i]?temp=l.splice(i,1):i++;for(i=0;i<l.length;)temp=e.substring(l[i],l[i]+3),"<%%"==temp?(l.splice(i,1),c.splice(i,1)):i++}if(0!=l.length&&(a=0,o=l[0],a<o&&(r.push(e.substring(a,o).trim()),s.push("HTML"))),l.length>0)for(i=0;i<l.length;i++)r.push(e.substring(l[i]+u,c[i]+d).trim()),s.push("JS"),i==l.length-1&&c[i]!=n-1?(r.push(e.substring(c[i]+2).trim()),s.push("HTML")):(r.push(e.substring(c[i]+2,l[i+1]).trim()),s.push("HTML"));else r.push(e),s.push("HTML");return{type:s,code:r}}function interpret(e,t){let n=[],i=0;for(;i<t.length;){switch(e[i]){case"HTML":n.push(t[i].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==t[i].substring(0,1)){try{n.push(basicCode(t[i].substring(1)))}catch(e){n.push("invalid template script")}break}if("-"==t[i].substring(0,1)){try{n.push(basicCode(t[i].substring(1)))}catch(e){n.push("invalid template script")}break}{let r=eachBlock(e,t,i);i=r.index;try{n.push(controlCode(r.partBlock))}catch(e){n.push("invalid template script")}break}}i++}return n}function interpretPart(e,t,n){let r=[],s="",l=[],c=[],a=[],o=0,u=0,d=0;for(i=0;i<t.length;i++)if(a.length=0,"HTML"==e[i]&&(o=0,s="",a=t[i].replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").split("<"),a.forEach((e=>{e.includes("class=")&&e.includes(n)&&(s=e.substring(0,e.indexOf(" ")))})),s.length>1))for(tag_cnt=0,u=sync_block[i+1],o=i+1;o<t.length&&sync_block[o]==u;o++)l.push(e[o]),c.push(t[o]);for(;d<c.length;){switch(l[d]){case"HTML":r.push(c[d].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==c[d].substring(0,1)){try{r.push(basicCode(c[d].substring(1)))}catch(e){r.push("invalid template script")}break}if("-"==c[d].substring(0,1)){try{r.push(basicCode(c[d].substring(1)))}catch(e){r.push("invalid template script")}break}{let e=eachBlock(l,c,d);d=e.index;try{r.push(controlCode(e.partBlock))}catch(e){r.push("invalid template script")}break}}d++}return r}function makeSyncBlock(e,t){sync_block.length=0;let n=0,r=0,s=0;for(i=0;i<t.length;i++){switch(e[i]){case"HTML":sync_block.push(n);break;case"JS":if("="==t[i].substring(0,1)||"-"==t[i].substring(0,1)){sync_block.push(n);break}for(r=findBlockEnd(e,t,i).index,s=findBlockEnd(e,t,i).error,s<0?console.log("ERROR: missing {"):s>0&&console.log("ERROR: missing }"),j=0;j<r-i+1;j++)sync_block.push(n);i=r}n++}return sync_block}function findBlockEnd(e,t,n){let i=0;for(j=n;j<t.length;j++)if(j!=n||"JS"!=e[j]){if("HTML"!=e[j]&&"JS"==e[j])if("="==t[j].substring(0,1)||"-"==t[j].substring(0,1));else if(t[j].includes("{")&&i++,t[j].includes("}")&&i--,0==i)return{index:j,error:0}}else if(t[j].includes("{")&&i++,t[j].includes("}")&&i--,0==i)return{index:j,error:0};return 0!=i?{index:n,error:i}:{index:j,error:i}}function eachBlock(e,t,n){let i="",r=0,s=0;for(s=n;s<t.length;s++){if(s==n){if("JS"==e[s]){if(t[s].includes("{")&&r++,t[s].includes("}")&&r--,0==r)return{partBlock:t[s],index:s};i=`let answer=''; ${t[s]}`;continue}i=`let answer='${t[s]}';`}if("HTML"!=e[s]){if("JS"==e[s])if("="==t[s].substring(0,1))i+=`answer=answer+${t[s].substring(1)};`;else if("-"==t[s].substring(0,1))i+=`answer=answer+${t[s].substring(1)};`;else if(i+=t[s],t[s].includes("{")&&r++,t[s].includes("}")&&r--,0==r)return i+="; return answer;",{partBlock:i,index:s}}else i+=`answer=answer+'${t[s]}';`}return i+="; return answer;",{partBlock:i,index:s}}function insertSync(e,t,n){let r=-1,s=0,l=0,c="",a="",o="",u="",d=0,p=0,h=0;for(i=0;i<n.length;i++)if(n[i]!=r&&"JS"==e[i]){for(r=n[i],p=0,h=0,d=i,j=i;j<n.length&&n[j]==n[d];j++)p=j;o=t[i-1],">"!=o.substring(o.length-1)?(l=o.lastIndexOf(">"),s=o.lastIndexOf("<"),l<s?(c=o.substring(s),c.includes("class=")?(h=o.indexOf("class=",s)+7,t[i-1]=o.substring(0,h)+"et_sync "+o.substring(h)):(u=t[i+1],l=u.indexOf(">"),c=u.substring(0,l),c.includes("class=")?(h=u.indexOf("class=")+7,t[i+1]=u.substring(0,h)+"et_sync "+u.substring(h)):(s=o.lastIndexOf("<"),l=o.indexOf(" ",s),t[i-1]=o.substring(0,l+1)+'class="et_sync" '+o.substring(l+1)))):(t[i-1]=t[i-1]+'<span class="et_sync">',t[p+1]="</span>"+t[p+1])):(s=o.lastIndexOf("<"),a=o.substring(s+1,o.length).split(" ")[0],t[p+1].includes("</"+a)&&t[p+1].indexOf("</"+a)<(-1==t[p+1].indexOf("<"+a)?t[p+1].length:t[p+1].indexOf("<"+a))?(l=o.length-1,s=o.lastIndexOf("<"),c=o.substring(s,l+1),c.includes("class=")?(h=o.indexOf("class=",s)+7,t[i-1]=o.substring(0,h)+"et_sync "+o.substring(h)):t[i-1]=o.substring(0,o.length-1)+' class="et_sync"'+o.substring(o.length-1,o.length)):(t[i-1]=t[i-1]+'<span class="et_sync">',t[i+1]="</span>"+t[i+1]))}else r=n[i];return{type:e,code:t}}function basicCode(e){try{return Function(`"use strict"; return ( ${e.substring(1)} )`)()}catch(e){return"invalid template script"}}function controlCode(e){try{return Function(`"use strict"; ${e.replace(/[\n\r\t]/g,"")}`)()}catch(e){return"invalid template script"}}function currentUrl(){let e=window.location.href,t=window.location.hash;e=e.replace(t,"");let n=e.split("/").pop(),i=e.substring(0,e.length-n.length);return n.length<1&&(n="index.html"),{host:i,filename:n}}function createVariable(e){et=e}function replaceAt(e,t,n){return e.substr(0,t)+n+e.substr(t+n.length)}function loadjscssfile(e,t){if("js"==t)(n=document.createElement("script")).setAttribute("type","text/javascript"),n.setAttribute("src",e);else if("css"==t){var n;(n=document.createElement("link")).setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e)}void 0!==n&&document.getElementsByTagName("head")[0].appendChild(n)}function createjscssfile(e,t){if("js"==t){let t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e)}else if("css"==t){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)}return fileref}function replacejscssfile(e){let t=document.getElementsByTagName("link"),n=new Array(t.length),r=0,s="";for(i=0;i<t.length;i++)n[i]=0;for(i=0;i<e.length;i++){r=0;for(let l=t.length-1;l>=0;l--)s=t[l].getAttribute("href"),s=s.replace(currentUrl().host,"/"),-1!=s.indexOf(e[i])&&(r++,n[l]++);0==r&&loadjscssfile(e[i],"css")}for(i=0;i<n.length;i++)0==n[i]&&t[i].parentNode.removeChild(t[i])}const setInnerHTML=function(e){Array.from(e.querySelectorAll("script")).forEach((e=>{const t=document.createElement("script");Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(t,e)}))};function hashtofilename(e){let t=window.location.hash;return""!=t&&""==e&&(e=t.substring(1)+".html"),e}const countTag=(e,t)=>e.split(t).length-1;function escapeHtml(e){"use strict";return e.replace(/[\"&<>]/g,(function(e){return{'"':"&quot;","&":"&amp;","<":"&lt;",">":"&gt;"}[e]}))}function eTemplateCheolhwan(){console.log("Author: Cheolhwan Yun")}document.onmouseover=function(){window.innerDocClick=!0},document.onmouseleave=function(){window.innerDocClick=!1};