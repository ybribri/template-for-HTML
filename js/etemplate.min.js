const eTemplate=function(){this.sync_type=[],this.sync_code=[],this.sync_block=[],this.cssRules=[],this.tRulePos=[],this.tSubRulePos=[],this.tStylePos=[],this.eTem={},this.syncCnt=0};eTemplate.prototype.render=async function(e){this.syncCnt=0;let t=(e=e||{}).sync_url||"",s=e.scrollto||"",i=e.iscope||"";this.eTem.sync_url=t,this.eTem.start_url=e.start_url||"",this.eTem.sync_class=e.sync_class||"et_sync";let l=this.currentUrl().host+this.currentUrl().filename;t=this.hashtofilename(t),t=""==t&&""!=this.eTem.start_url?this.eTem.start_url:t,l=""!=t?this.currentUrl().host+t:l,this.myUrl=l;const n=await fetch(l),r=await n.text(),o=await this.getGoing(r,i);return this.removeAllChildNodes(document.querySelector("body")),document.body.insertAdjacentHTML("afterbegin",o.htmlBlock.join("")),""!=s&&0!=Object.keys(s).length&&document.getElementById(s.id).scrollIntoView({block:s.block}),this.sync_code=o.t_code.code,this.sync_type=o.t_code.type,"function"==typeof addListener&&addListener(t),document.body.style.display="block",new Promise(((e,t)=>{e("done")}))},eTemplate.prototype.getGoing=async function(e,t){let s="";"body"!=t&&await this.changeCss(e),this.changeTitle();let i=this.findInclude(e),l=i.urls,n=i.order,r=i.t_code;if(0!=l.length){let e=l.map((e=>fetch(e))),t=await Promise.all(e),o=t.filter((e=>!e.ok));if(o.length>0)throw o.map((e=>Error(e.statusText)));let c=t.map((e=>e.text())),u=await Promise.all(c);u.forEach(((e,t)=>{r[n[t]]=e}));let a=r.join("");if(i=this.findInclude(a),l=i.urls,n=i.order,r=i.t_code,0!=l.length){if(e=l.map((e=>fetch(e))),t=await Promise.all(e),o=t.filter((e=>!e.ok)),o.length>0)throw o.map((e=>Error(e.statusText)));c=t.map((e=>e.text())),u=await Promise.all(c),u.forEach(((e,t)=>{r[n[t]]=e})),s=r.join("")}else s=a}else s=r.join("");r=this.seperateCode(s,"second");let o=this.makeSyncBlock(r.type,r.code);"JS"==r.type[0]&&(r.type.unshift("HTML"),r.code.unshift(" "),o=o.map((e=>e+1)),o.unshift(0)),r=this.insertSync(r.type,r.code,o),this.sync_block=o,this.syncCnt=r.syncCnt;let c=this.interpret(r.type,r.code);return new Promise(((e,t)=>{e({htmlBlock:c,t_code:r})}))},eTemplate.prototype.renderPart=async function(e,t){let s,i="",l="",n="",r=[],o=[],c="",u=[],a="";if(e=e||"",""==(t=t||"").trim())return"select type from html,css, html_path, css-path";if(""==e.trim())return"nothing to render";switch(t){case"html":return i=e,r=this.seperateCode(i,"second"),o=this.makeSyncBlock(r.type,r.code),"JS"==r.type[0]&&(r.type.unshift("HTML"),r.code.unshift(" "),o=o.map((e=>e+1)),o.unshift(0)),r=this.insertSync(r.type,r.code,o),l=this.interpret(r.type,r.code),c=l.join(""),{domText:c,sourceType:r.type,sourceCode:r.code,sourceSync:o};case"css":return i=e,u=this.parseCSS(i),s=this.interpretCss(u),a=s.modifiedCss,{cssText:a,cssRules:u,tRulePos:s.tRulePos,tStylePos:s.tStylePos,tSubRulePos:s.tSubRulePos};case"html_path":n=window.location.host+e;try{const e=await fetch(n);i=await e.text()}catch(e){return"wrong pathname"}return r=this.seperateCode(i,"second"),o=this.makeSyncBlock(r.type,r.code),"JS"==r.type[0]&&(r.type.unshift("HTML"),r.code.unshift(" "),o=o.map((e=>e+1)),o.unshift(0)),r=this.insertSync(r.type,r.code,o),l=this.interpret(r.type,r.code),c=l.join(""),{domText:c,sourceType:r.type,sourceCode:r.code,sourceSync:o};case"css_path":n=window.location.host+e;try{const e=await fetch(n);i=await e.text()}catch(e){return"wrong pathname"}return u=this.parseCSS(i),s=this.interpretCss(u),a=s.modifiedCss,{cssText:a,cssRules:u,tRulePos:s.tRulePos,tStylePos:s.tStylePos,tSubRulePos:s.tSubRulePos}}},eTemplate.prototype.appendHtml=function(e,t){let s=(e=e||{}).domText||"";if(null==t)return"nowhere to append";const i=e.sourceType||[],l=e.sourceCode||[],n=e.sourceSync||[];return"DOMobject"!=this.getObjectType(t)||0==i.length?"nothing to append":(this.sync_type=this.sync_type.concat(i),this.sync_code=this.sync_code.concat(l),this.sync_block=this.sync_block.concat(n),""==s.trim()?"nothing to append":(s=s.trim(),void t.insertAdjacentHTML("beforeend",s)))},eTemplate.prototype.appendCss=function(e){(e=e||{}).cssText;const t=e.cssRules||[],s=e.tRulePos||[],i=e.tStylePos||[],l=e.tSubRulePos||[];let n=this.tRulePos[s.length-1];t.forEach((e=>{n+1})),this.cssRules=this.cssRules.concat(t),this.tRulePos=this.tRulePos.concat(s),this.tStylePos=this.tStylePos.concat(i),this.tSubRulePos=this.tSubRulePos.concat(l),this.syncCss()},eTemplate.prototype.changeTitle=function(){let e=null;null!=document.querySelector("title").innerText.trim().match(/<%.*?%>/g)&&(e=document.querySelector("title").innerText.trim().match(/<%.*?%>/g)[0].replaceAll("<%","").replaceAll("%>",""));let t="";null!=e&&(t=this.basicCode(e),document.head.querySelector("title").innerText=t)},eTemplate.prototype.combineCss=async function(e){let t="",s=[];const i=/<link.*?(rel=("|')stylesheet("|')).*?>/gi,l=/<style>(.|[\t\n\r])*?<.style>/gi;if(""==this.eTem.sync_url){if(""==document.querySelector("head").innerHTML.trim())return"";let e=document.querySelectorAll("head style");for(let s=0;s<e.length;s++)t+=e[s].innerHTML;document.querySelectorAll('link[rel="stylesheet"]').forEach((e=>{let t=e.outerHTML,i=t.indexOf('href="')+6,l=t.indexOf('"',i);t=t.substring(i,l),t.includes("http")||s.push(e.href)}))}else{let n=e.indexOf("<head>"),r=e.indexOf("</head>");if(-1==n||-1==r)return"";let o=e.substring(n+6,r),c=o.querySelector("title").innerText;c!=document.querySelector("title").innerText&&(document.querySelector("title").innerText=c);let u=[];o.replace(i,(function(e){return u.push(e),""}));let a=this.myUrl.split("/").pop(),h=this.myUrl.substring(0,this.myUrl.length-a.length);u.forEach((e=>{s.push(h+e.match(/href=".*?"/gi).replaceAll("href=","").replaceAll('"',""))}));let p=[];o.replace(l,(function(e){return p.push(e.replaceAll("<style>","").replaceAll("</style>","")),""})),t=p.join("")}if(0!=s.length){let e=s.map((e=>fetch(e))),i=await Promise.all(e);if(errors=i.filter((e=>!e.ok)),errors.length>0)throw errors.map((e=>Error(e.statusText)));let l=i.map((e=>e.text()));(await Promise.all(l)).forEach((e=>{t+=e}))}return t},eTemplate.prototype.interpretCss=function(e){let t=[],s=[],l=[],n="",r="",o=[],c=[];for(let i=0;i<e.length;i++){let n=e[i];switch(null==n.type?"":n.type){case"":case"font-face":for(let e=0;e<n.rules.length;e++)n.rules[e].value.indexOf("<%")>-1&&(t.push(i),s.push(-1),l.push(e));break;case"imports":case"keyframes":n.styles.indexOf("<%")>-1&&(t.push(i),s.push(-2),l.push(0));break;case"media":for(let e=0;e<n.subStyles.length;e++){let r=n.subStyles[e];for(let n=0;n<r.rules.length;n++)r.rules[n].value.indexOf("<%")>-1&&(t.push(i),s.push(e),l.push(n))}}}if(t.length>0){let u=JSON.parse(JSON.stringify(e));for(i=0;i<t.length;i++)-1==s[i]?(n=u[t[i]].rules[l[i]].value,o=this.seperateCode(n,"second"),c=this.interpret(o.type,o.code),n=c.join(""),u[t[i]].rules[l[i]].value=n):-2==s[i]?(n=u[t[i]].styles,o=this.seperateCode(n,"second"),c=this.interpret(o.type,o.code),n=c.join(""),u[t[i]].styles=n):(n=u[t[i]].subStyles[s[i]].rules[l[i]].value,o=this.seperateCode(n,"second"),c=this.interpret(o.type,o.code),n=c.join(""),u[t[i]].subStyles[s[i]].rules[l[i]].value=n);for(let e=0;e<u.length;e++){let t=u[e];switch(null==t.type?"":t.type){case"":case"font-face":r=r+t.selector+" {\n";for(let e=0;e<t.rules.length;e++)r+=` ${t.rules[e].key}: ${t.rules[e].value};\n`;r+="}\n";break;case"imports":case"keyframes":r=r+t.styles+"\n";break;case"media":r=r+t.selector+" {\n";for(let e=0;e<t.subStyles.length;e++){let s=t.subStyles[e];r=r+" "+s.selector+" {\n";for(let e=0;e<s.rules.length;e++)r+=` ${s.rules[e].key}: ${s.rules[e].value};\n`;r+=" }\n"}r+="}\n"}}}return{modifiedCss:r,tRulePos:t,tSubRulePos:s,tStylePos:l}},eTemplate.prototype.changeCss=async function(e){let t=await this.combineCss(e),s=this.parseCSS(t),i=this.interpretCss(s);const l=i.modifiedCss;this.cssRules=s,this.tRulePos=i.tRulePos,this.tSubRulePos=i.tSubRulePos,this.tStylePos=i.tStylePos,""!=l&&(document.querySelectorAll("style").forEach((e=>{e.parentNode.removeChild(e)})),t_style=document.createElement("style"),t_style.appendChild(document.createTextNode(l)),document.head.appendChild(t_style),document.head.querySelectorAll("link").forEach((e=>{"stylesheet"==e.getAttribute("rel")&&e.parentNode.removeChild(e)})))},eTemplate.prototype.syncCss=function(){let e="",t="",s="",l=[],n=[];for(i=0;i<this.tRulePos.length;i++)-1==this.tSubRulePos[i]?(t=this.cssRules[this.tRulePos[i]].rules[this.tStylePos[i]].value,e=this.cssRules[this.tRulePos[i]].rules[this.tStylePos[i]].key,l=this.seperateCode(t,"second"),n=this.interpret(l.type,l.code),s=n.join(""),document.styleSheets[0].cssRules[this.tRulePos[i]].style.setProperty(e,s)):-2==this.tSubRulePos[i]?(t=this.cssRules[this.tRulePos[i]].styles,l=this.seperateCode(t,"second"),n=this.interpret(l.type,l.code),t=n.join(""),document.styleSheets[0].deleteRule(this.tRulePos[i]),document.styleSheets[0].insertRule(t,this.tRulePos[i])):(t=this.cssRules[this.tRulePos[i]].subStyles[this.tSubRulePos[i]].rules[this.tStylePos[i]].value,e=this.cssRules[this.tRulePos[i]].subStyles[this.tSubRulePos[i]].rules[this.tStylePos[i]].key,l=this.seperateCode(t,"second"),n=this.interpret(l.type,l.code),s=n.join(""),document.styleSheets[0].cssRules[this.tRulePos[i]].cssRules[this.tSubRulePos[i]].style.setProperty(e,s))},eTemplate.prototype.sync=function(e){let t="",s=this.eTem.sync_class;this.changeTitle(),document.querySelectorAll(`.${s}`).forEach((e=>{if(t="","INPUT"==e.nodeName){t=e.getAttribute("data-sync"),"number"==e.type?t+="="+(e.value?e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;"):'""'):t+="="+(e.value?'"'+e.value.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("(","&#40;").replaceAll(")","&#41;")+'"':'""');try{temp_code=this.controlCode(t)}catch(e){return e}}}));let i=this.interpretPart(this.sync_type,this.sync_code,s);if(document.querySelectorAll(`.${s}`).forEach((e=>{let t=e.classList,l="",n=!1,r=0;t.forEach((e=>{e.includes(`${s}_`)&&(n=!0,l=e.split("_").pop()),e.includes(`${s}Cnt`)&&(r=parseInt(e.replace(`${s}Cnt`,""),10))})),n?e.setAttribute(l,i[r]):(this.removeAllChildNodes(e),e.insertAdjacentHTML("afterbegin",i[r]))})),"function"==typeof addListener){let e=this.hashtofilename();addListener(e)}"body"!=e&&this.syncCss()},eTemplate.prototype.findInclude=function(e){let t=[],s=[],l=[],n="",r=0,o="",c=e.indexOf("<body>"),u=e.indexOf("</body>");o=-1==c||-1==u?e:e.substring(c+6,u);let a=this.seperateCode(o,"first");for(i=0;i<a.type.length;i++)"JS"==a.type[i]&&-1!=a.code[i].search(/include\(.*\)/g)&&(t.push(a.code[i]),l[r]=i,r++);return 0!=t.length&&t.forEach((e=>{e.includes("include(")&&(c=e.indexOf('include("'),-1==c?c=e.indexOf("include('")+9:c+=9,u=e.indexOf('")'),-1==u&&(u=e.indexOf("')")),n=e.substring(c,u),n="/"==n.substring(0,1)?n.substring(1):n,n="./"==n.substring(0,2)?n.substring(2):n,s.push(this.currentUrl().host+n))})),{urls:s,order:l,t_code:a.code}},eTemplate.prototype.seperateCode=function(e,t){let s=e.split(/(<%[^%].*?%>)/g),i=[];return s.forEach(((e,l)=>{let n=e.indexOf("<%"),r=e.indexOf("%>");0==n&&r==e.length-2?(i.push("JS"),s[l]="second"==t?e.substring(2,e.length-2).trim():e.trim()):(i.push("HTML"),s[l]=e.replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").trim())})),{type:i,code:s}},eTemplate.prototype.interpret=function(e,t){let s=[],i=0;for(;i<t.length;){switch(e[i]){case"HTML":s.push(t[i].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==t[i].substring(0,1)){try{s.push(this.basicCode(t[i].substring(1)))}catch(e){s.push("invalid template")}break}if("-"==t[i].substring(0,1)){try{s.push(this.basicCode(t[i].substring(1)))}catch(e){s.push("invalid template")}break}{let l=this.eachBlock(e,t,i);i=l.index;try{s.push(this.controlCode(l.partBlock))}catch(e){s.push("invalid template")}break}}i++}return s},eTemplate.prototype.interpretPart=function(e,t,s){let i=[],l="",n=[],r=[],o=[],c=0,u=0,a=0,h=0;for(c=0;c<t.length;c++)if(o.length=0,"HTML"==e[c]&&(u=0,l="",o=t[c].replaceAll("\r","").replaceAll("\n","").replaceAll("\t","").split("<"),o.forEach((e=>{e.includes("class=")&&e.includes(s)&&(l=e.substring(0,e.indexOf(" ")).trim())})),l.length>0))for(a=this.sync_block[c+1],u=c+1;u<t.length&&this.sync_block[u]==a;u++)n.push(e[u]),r.push(t[u]);for(;h<r.length;){switch(n[h]){case"HTML":i.push(r[h].replaceAll("<%%","&lt;%").replaceAll("%>","%&gt;"));break;case"JS":if("="==r[h].substring(0,1)){try{i.push(this.basicCode(r[h].substring(1)))}catch(e){i.push("invalid template script")}break}if("-"==r[h].substring(0,1)){try{i.push(this.basicCode(r[h].substring(1)))}catch(e){i.push("invalid template script")}break}{let e=this.eachBlock(n,r,h);h=e.index;try{i.push(this.controlCode(e.partBlock))}catch(e){i.push("invalid template script")}break}}h++}return i},eTemplate.prototype.makeSyncBlock=function(e,t){let s=[],l=0,n=0,r=0;for(i=0;i<t.length;i++){switch(e[i]){case"HTML":s.push(l);break;case"JS":if("="==t[i].substring(0,1)||"-"==t[i].substring(0,1)){s.push(l);break}for(n=this.findBlockEnd(e,t,i).index,r=this.findBlockEnd(e,t,i).error,r<0?console.log("ERROR: missing {"):r>0&&console.log("ERROR: missing }"),j=0;j<n-i+1;j++)s.push(l);i=n}l++}return s},eTemplate.prototype.findBlockEnd=function(e,t,s){let i=0;for(j=s;j<t.length;j++)if(j!=s||"JS"!=e[j]){if("HTML"!=e[j]&&"JS"==e[j]&&"="!=t[j].substring(0,1)&&"-"!=t[j].substring(0,1)&&(t[j].includes("{")&&i++,t[j].includes("}")&&i--,0==i))return{index:j,error:0}}else if(t[j].includes("{")&&i++,t[j].includes("}")&&i--,0==i)return{index:j,error:0};return 0!=i?{index:s,error:i}:{index:j,error:i}},eTemplate.prototype.eachBlock=function(e,t,s){let i="",l=0,n=0;for(n=s;n<t.length;n++){if(n==s){if("JS"==e[n]){if(t[n].includes("{")&&l++,t[n].includes("}")&&l--,0==l)return{partBlock:t[n],index:n};i=`let answer=''; ${t[n]}`;continue}i=`let answer='${t[n]}';`}if("HTML"!=e[n]){if("JS"==e[n])if("="==t[n].substring(0,1))i+=`answer=answer+${t[n].substring(1)};`;else if("-"==t[n].substring(0,1))i+=`answer=answer+${t[n].substring(1)};`;else if(i+=t[n],t[n].includes("{")&&l++,t[n].includes("}")&&l--,0==l)return i+="; return answer;",{partBlock:i,index:n}}else i+=`answer=answer+'${t[n]}';`}return i+="; return answer;",{partBlock:i,index:n}},eTemplate.prototype.insertSync=function(e,t,s){let l=-1,n=0,r=0,o="",c="",u="",a="",h=0,p=0,d=0,y=this.syncCnt;const f=this.eTem.sync_class;for(i=0;i<s.length;i++)if(s[i]!=l&&"JS"==e[i]){for(l=s[i],p=0,d=0,h=i,j=i;j<s.length&&s[j]==s[h];j++)p=j;if(u=t[i-1],">"!=u.substring(u.length-1))if(r=u.lastIndexOf(">"),n=u.lastIndexOf("<"),r<n){o=u.substring(n);let e=u.lastIndexOf(" "),s=u.lastIndexOf('="'),l=u.substring(e+1,s);o.includes("class=")?(d=u.indexOf("class=",n)+7,t[i-1]=`${u.substring(0,d)}${f} ${f}_${l} ${f}Cnt${y} ${u.substring(d)}`,y++):(a=t[i+1],r=a.indexOf(">"),o=a.substring(0,r),o.includes("class=")?(d=a.indexOf("class=")+7,t[i+1]=`${a.substring(0,d)}${f} ${f}_${l} ${f}Cnt${y} ${a.substring(d)}`,y++):(n=u.lastIndexOf("<"),r=u.indexOf(" ",n),t[i-1]=`${u.substring(0,r+1)} class="${f} ${f}_${l} ${f}Cnt${y}" ${u.substring(r+1)}`,y++))}else t[i-1]=t[i-1]+`<span class="${f} ${f}Cnt${y}">`,y++,t[p+1]="</span>"+t[p+1];else n=u.lastIndexOf("<"),c=u.substring(n+1,u.length).split(" ")[0],"</"!=u.substring(n,n+2)?t[p+1].includes("</"+c)&&t[p+1].indexOf("</"+c)<(-1==t[p+1].indexOf("<"+c)?t[p+1].length:t[p+1].indexOf("<"+c))?(r=u.length-1,n=u.lastIndexOf("<"),o=u.substring(n,r+1),o.includes("class=")?(d=u.indexOf("class=",n)+7,t[i-1]=`${u.substring(0,d)}${f} ${f}Cnt${y} ${u.substring(d)}`,y++):(t[i-1]=`${u.substring(0,u.length-1)} class="${f} ${f}Cnt${y}" ${u.substring(u.length-1,u.length)}`,y++)):(t[i-1]=`${t[i-1]}<span class="${f} ${f}Cnt${y}">`,y++,t[i+1]=`</span>${t[i+1]}`):(t[i-1]=`${t[i-1]}<span class="${f} ${f}Cnt${y}">`,y++,t[p+1]=`</span>${t[p+1]}`)}else l=s[i];return{type:e,code:t,syncCnt:y}},eTemplate.prototype.basicCode=function(e){try{return Function(`"use strict"; return ( ${e.substring(1)} )`)()}catch(e){return"invalid template script"}},eTemplate.prototype.controlCode=function(e){try{return Function(`"use strict"; ${e.replace(/[\n\r\t]/g,"")}`)()}catch(e){return"invalid template script"}},eTemplate.prototype.currentUrl=function(){let e=window.location.href,t=window.location.hash;e=e.replace(t,"");let s=e.split("/").pop(),i=e.substring(0,e.length-s.length);return s.length<1&&(s=t.length>0?t.substring(1)+".html":"index.html"),{host:i,filename:s}},eTemplate.prototype.loadjscssfile=function(e,t){if("js"==t)(s=document.createElement("script")).setAttribute("type","text/javascript"),s.setAttribute("src",e);else if("css"==t){var s;(s=document.createElement("link")).setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",e)}void 0!==s&&document.getElementsByTagName("head")[0].appendChild(s)},eTemplate.prototype.createjscssfile=function(e,t){if("js"==t){let t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src",e)}else if("css"==t){let t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e)}return fileref},eTemplate.prototype.replacejscssfile=function(e){let t=document.querySelectorAll('link[rel="stylesheet"]'),s=new Array(t.length),l=0,n="";for(i=0;i<t.length;i++)s[i]=0;for(i=0;i<e.length;i++){l=0;for(let r=t.length-1;r>=0;r--)n=t[r].getAttribute("href"),n=n.replace(this.currentUrl().host,"/"),-1!=n.indexOf(e[i])&&(l++,s[r]++);0==l&&this.loadjscssfile(e[i],"css")}for(i=0;i<s.length;i++)0==s[i]&&t[i].parentNode.removeChild(t[i])},eTemplate.prototype.getObjectType=e=>("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)?"DOMobject":e.includes("<%")&&e.includes("%>")?"template":e.includes(".html")?"html_path":e.includes(".css")?"css_path":"undefined",eTemplate.prototype.hashtofilename=function(e){let t=window.location.hash;return""!=t&&""==e&&(e=t.substring(1)+".html"),e},eTemplate.prototype.removeAllChildNodes=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},eTemplate.prototype.parseCSS=function(e){if(void 0===e)return[];let t=[],s=new RegExp("@import .*(.*)?;","gi"),i=[];for(;;){let l=s.exec(e);if(null===l)break;t.push(l[0]),i.push({selector:"@imports",type:"imports",styles:l[0]})}e=e.replace(s,"");let l,n=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;l=n.exec(e),null!==l;)i.push({selector:"@keyframes",type:"keyframes",styles:l[0]});e=e.replace(n,"");let r=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;l=r.exec(e),null!==l;){let e="";if(e=void 0===l[2]?l[5].split("\r\n").join("\n").trim():l[2].split("\r\n").join("\n").trim(),e=e.replace(/\n+/,"\n"),-1!==e.indexOf("@media")){let t={selector:e,type:"media",subStyles:this.parseCSS(l[3]+"\n}")};i.push(t)}else{let t={selector:e,rules:this.parseRules(l[6])};"@font-face"===e&&(t.type="font-face"),i.push(t)}}return i},eTemplate.prototype.parseRules=function(e){let t=[];e=(e=e.split("\r\n").join("\n")).split(";");for(let s=0;s<e.length;s++){let i=e[s];if(i=i.trim(),-1!==i.indexOf(":")){i=i.split(":");let e=i[0].trim(),s=i.slice(1).join(":").trim();if(e.length<1||s.length<1)continue;t.push({key:e,value:s})}else"base64,"===i.trim().substr(0,7)?t[t.length-1].value+=i.trim():i.length>0&&t.push({key:"",value:i,defective:!0})}return t},document.onmouseover=function(){window.innerDocClick=!0},document.onmouseleave=function(){window.innerDocClick=!1};let etm_temp={};